{% assign news_by_year = site.news | sort: "date" | reverse | slice: 0, include.limit | group_by_exp: "item", "item.date | date: '%Y'" -%}

<div class="my-3 bg-white shadow-sm rounded-sm news-card">
    <!-- å¤´éƒ¨ï¼šæ ‡é¢˜ + ä¸Šä¸‹æ»šåŠ¨æŒ‰é’® -->
    <div class="news-card-header p-3 mb-0 border-bottom border-gray d-flex align-items-center">
        <div class="d-flex align-items-center">
            <span class="mr-2">ğŸ”¥</span>
            <span class="font-weight-bold">News</span>
        </div>

        <div class="ml-auto d-flex align-items-center">
            {% if site.news and site.news.size > 0 %}
            <span class="text-muted small mr-2">
                Latest {{ include.limit | default: site.news.size }}
            </span>
            {% endif %}
            <div class="btn-group btn-group-sm" role="group" aria-label="Scroll news">
                <button type="button" class="btn btn-light news-scroll-btn news-scroll-up" title="Scroll up">
                    â–²
                </button>
                <button type="button" class="btn btn-light news-scroll-btn news-scroll-down" title="Scroll down">
                    â–¼
                </button>
            </div>
        </div>
    </div>

    <!-- å¯æ»šåŠ¨åŒºåŸŸ -->
    <div class="px-3 pb-2">
        <div class="news-scroll-window" id="news-scroll-window">
            {% assign not_first = false %}
            {% for year in news_by_year %}
            <div class="media py-2 {% if not_first %}border-top border-light{% endif %}">
                {% assign not_first = true %}
                <!-- å¹´ä»½æ ‡ç­¾ -->
                <div class="mr-3 my-1">
                    <span class="badge badge-pill news-year-badge">
                        {{ year.name }}
                    </span>
                </div>

                <!-- è¯¥å¹´çš„æ‰€æœ‰ news -->
                <div class="media-body">
                    {% for item in year.items %}
                    <div class="my-1 d-flex align-items-baseline news-item-row">
                        <div class="news-item-dot"></div>
                        <div class="flex-grow-1">
                            <div class="news-item-title">
                                {{ item.title }}
                            </div>
                        </div>
                        <div class="ml-2 mt-auto text-muted no-break news-item-date">
                            <i>{{ item.date | date: "%b %d" }}</i>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div> 
</div>

<style>
/* ===== News å¡ç‰‡æ•´ä½“ ===== */
.news-card {
    border-radius: 0.6rem;
    border: 1px solid #f1f3f5;
    overflow: hidden;
}

/* å¤´éƒ¨èƒŒæ™¯ + è½»å¾®æ¸å˜ + ç»†é˜´å½±ï¼ˆæ”¹è¿›ç‚¹ 4ï¼‰ */
.news-card-header {
    background: linear-gradient(90deg, #ffffff 0%, #f8f9fa 50%, #ffffff 100%);
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.03);
}

/* ===== æ»šåŠ¨çª—å£ ===== */
.news-scroll-window {
    max-height: 240px;          /* æ§åˆ¶å¯è§†é«˜åº¦ï¼Œå¯æ ¹æ®æ„Ÿè§‰æ”¹ï¼Œæ¯”å¦‚ 220~280 */
    overflow-y: auto;
    padding-right: 4px;
    position: relative;         /* æ”¹è¿›ç‚¹ 1ï¼šä¸ºæ—¶é—´çº¿ç«–çº¿åšå®šä½ */
}

/* æ—¶é—´çº¿ç«–çº¿ï¼ˆæ”¹è¿›ç‚¹ 1ï¼‰ */
.news-scroll-window::before {
    content: "";
    position: absolute;
    left: 13px;                 /* å’Œå°åœ†ç‚¹å¤§è‡´å¯¹é½ï¼Œå¯å¾®è°ƒ */
    top: 6px;
    bottom: 6px;
    width: 2px;
    background: linear-gradient(
        to bottom,
        rgba(222, 226, 230, 0.0),
        rgba(222, 226, 230, 0.9),
        rgba(222, 226, 230, 0.0)
    );
    pointer-events: none;
}

/* æ¯æ¡ news å‰é¢çš„å°åœ†ç‚¹ + å¯¹é½ */
.news-item-row {
    position: relative;
    padding-left: 0.75rem;
    border-radius: 0.35rem;           /* æ”¹è¿›ç‚¹ 2ï¼šhover åœ†è§’ */
    padding-top: 2px;
    padding-bottom: 2px;
    transition: background-color .18s ease, transform .18s ease; /* æ”¹è¿›ç‚¹ 2ï¼šhover åŠ¨æ•ˆ */
}

.news-item-row:hover {
    background-color: #f8f9fa;
    transform: translateX(2px);
}

.news-item-dot {
    width: 6px;
    height: 6px;
    border-radius: 999px;
    background-color: #ced4da;
    margin-right: 0.4rem;
    flex-shrink: 0;
}

/* å¹´ä»½ badge */
.news-year-badge {
    background-color: #f8f9fa;
    border: 1px solid #e9ecef;
    color: #6c757d;
    font-size: 0.75rem;
}

/* æ–‡æœ¬ç»†èŠ‚ */
.news-item-title {
    font-size: 0.9rem;
    line-height: 1.35;
    word-break: break-word;          /* æ”¹è¿›ç‚¹ 2ï¼šé•¿æ ‡é¢˜æ¢è¡Œæ›´è‡ªç„¶ */
}

.news-item-date {
    font-size: 0.8rem;
}

/* ä¸Šä¸‹æ»šåŠ¨æŒ‰é’®ï¼šåœ†å½¢å°æŒ‰é’® */
.news-scroll-btn {
    width: 26px;
    height: 26px;
    border-radius: 999px;
    padding: 0;
    line-height: 1;
    font-size: 0.8rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-color: #e9ecef;
    box-shadow: none !important;
}

.news-scroll-btn:hover {
    background-color: #f1f3f5;
    border-color: #dee2e6;
}

.news-scroll-btn:active {
    background-color: #e9ecef;
}

/* å°å±å¹•é€‚é… */
@media (max-width: 576px) {
    .news-scroll-window {
        max-height: 210px;
    }
    .news-item-title {
        font-size: 0.85rem;
    }
    .news-item-date {
        font-size: 0.75rem;
    }
}

/* è‡ªå®šä¹‰ä¸€ä¸‹æ»šåŠ¨æ¡ï¼ˆWebKitï¼‰ */
.news-scroll-window::-webkit-scrollbar {
    width: 6px;
}
.news-scroll-window::-webkit-scrollbar-track {
    background: transparent;
}
.news-scroll-window::-webkit-scrollbar-thumb {
    background-color: #dee2e6;
    border-radius: 999px;
}
.news-scroll-window::-webkit-scrollbar-thumb:hover {
    background-color: #ced4da;
}
</style>

<script>
(function () {
  var container = document.getElementById('news-scroll-window');
  if (!container) return;

  var upBtn = document.querySelector('.news-scroll-up');
  var downBtn = document.querySelector('.news-scroll-down');
  var step = 80; // æ¯æ¬¡æ»šåŠ¨çš„é«˜åº¦ï¼ˆpxï¼‰ï¼Œå¯æŒ‰éœ€è¦è°ƒå¤§/è°ƒå°

  function smoothScroll(delta) {
    if ('scrollBy' in container) {
      container.scrollBy({ top: delta, left: 0, behavior: 'smooth' });
    } else {
      // å…¼å®¹æè€æµè§ˆå™¨ï¼šæ— åŠ¨ç”»æ»šåŠ¨
      container.scrollTop += delta;
    }
  }

  if (upBtn) {
    upBtn.addEventListener('click', function () {
      smoothScroll(-step);
    });
  }
  if (downBtn) {
    downBtn.addEventListener('click', function () {
      smoothScroll(step);
    });
  }
})();
</script>
